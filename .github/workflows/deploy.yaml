name: CI-CD Pipeline - 3-tier App Deployment

on:
  push:
    branches:
      - master
  pull_request:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3

      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Build with Maven
        run: mvn clean install

  notify-success:
    needs: build-and-deploy
    runs-on: ubuntu-latest
    if: success()
    steps:
      - name: Send Success Email Notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "âœ… SUCCESS | 3-tier applicationn CI/CD Completed"
          to: ${{ secrets.EMAIL_USERNAME }}
          from: ${{ secrets.EMAIL_USERNAME }}
          body: |
            ğŸ‘‹ Hello Ameer's Team,

            âœ… The GitHub Actions CI/CD pipeline for the 3-tier application project has completed successfully.

            ğŸ”¹ Repository: ${{ github.repository }}
            ğŸ”¹ Branch: ${{ github.ref_name }}
            ğŸ”¹ Run ID: ${{ github.run_id }}

            ğŸ”— View Logs: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

            Keep up the great work!

  notify-failure:
    needs: build-and-deploy
    runs-on: ubuntu-latest
    if: failure()
    steps:
      - name: Send Failure Email Notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: "âŒ FAILURE | 3-tier applicationn CI/CD Build Failed"
          to: ${{ secrets.EMAIL_USERNAME }}
          from: ${{ secrets.EMAIL_USERNAME }}
          body: |
            ğŸ‘‹ Hello Ameer's Team,

            âŒ The GitHub Actions CI pipeline for the 3-tier application project has failed.

            ğŸ”¹ Repository: ${{ github.repository }}
            ğŸ”¹ Branch: ${{ github.ref_name }}
            ğŸ”¹ Run ID: ${{ github.run_id }}

            âš  Please check the logs and resolve any issues.

            ğŸ”— View Logs: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

            Let's fix it and try again!
